<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Excel Table with Dynamic Lookup</title>
<style>
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background-color: #f0f0f0; }
  input { width: 100%; box-sizing: border-box; }
  .main-col { background-color: #ffeeba; }
</style>
</head>
<body>

<h2>Upload Excel to Table</h2>
<input type="file" id="fileInput" accept=".xlsx,.xls,.csv">

<h3>Select Columns</h3>
<label>Main Key Column: 
  <select id="mainSelect"></select>
</label>
<label>Target Column: 
  <select id="targetSelect"></select>
</label>
<button id="lookupBtn">Lookup</button>

<table id="excelTable"></table>

<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<script>
let tableData = [];
let headerData = [];

const existingData = [
  { name: "DEWHIRST", address: "123 St", phone: "01060999" },
  { name: "NEW WIDE", address: "456 Ave", phone: "01231003" },
  { name: "COCOVOL", address: "789 Rd", phone: "09556824" }
];

document.getElementById("fileInput").addEventListener("change", async (e) => {
  const file = e.target.files[0];
  if (!file) return;

  const data = await file.arrayBuffer();
  const workbook = XLSX.read(data);
  const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
  const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });

  headerData = jsonData[0];
  tableData = jsonData.slice(1);

  populateColumnSelectors(headerData);
  renderTable(headerData, tableData);
});

function populateColumnSelectors(headers) {
  const mainSelect = document.getElementById("mainSelect");
  const targetSelect = document.getElementById("targetSelect");
  mainSelect.innerHTML = "";
  targetSelect.innerHTML = "";

  headers.forEach((col, i) => {
    const opt1 = document.createElement("option");
    opt1.value = i;
    opt1.innerText = col;
    mainSelect.appendChild(opt1);

    const opt2 = document.createElement("option");
    opt2.value = i;
    opt2.innerText = col;
    targetSelect.appendChild(opt2);
  });
}

function renderTable(headers, data) {
  const table = document.getElementById("excelTable");
  table.innerHTML = "";

  // Header
  const thead = document.createElement("thead");
  const headerRow = document.createElement("tr");
  headers.forEach(h => {
    const th = document.createElement("th");
    th.innerText = h;
    headerRow.appendChild(th);
  });
  thead.appendChild(headerRow);
  table.appendChild(thead);

  // Body
  const tbody = document.createElement("tbody");
  data.forEach(row => {
    const tr = document.createElement("tr");
    row.forEach(cell => {
      const td = document.createElement("td");
      const input = document.createElement("input");
      input.value = cell || "";
      td.appendChild(input);
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
  table.appendChild(tbody);
}

document.getElementById("lookupBtn").addEventListener("click", () => {
  const mainIndex = parseInt(document.getElementById("mainSelect").value);
  const targetIndex = parseInt(document.getElementById("targetSelect").value);

  const tbody = document.querySelector("#excelTable tbody");
  tbody.querySelectorAll("tr").forEach((tr, rowIndex) => {
    const mainKey = tr.children[mainIndex].querySelector("input").value;
    const match = existingData.find(d => d.name === mainKey);
    if (match) {
      const targetInput = tr.children[targetIndex].querySelector("input");
      const targetHeader = headerData[targetIndex].toLowerCase();
      targetInput.value = match[targetHeader] || "";
    }
  });
});
</script>
</body>
</html>