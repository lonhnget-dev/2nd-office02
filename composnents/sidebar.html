<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Sidebar with Pages</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            display: flex;
            min-height: 100vh;
            background-color: #f5f7fa;
            transition: margin-left 0.3s ease;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background: linear-gradient(180deg, #2c3e50, #1a252f);
            color: white;
            height: 100vh;
            position: fixed;
            transition: transform 0.3s ease;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .sidebar.hidden {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .toggle-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .toggle-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu {
            padding: 10px 0;
            flex-grow: 1;
        }

        .menu-item {
            padding: 15px 20px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .menu-item.active {
            background-color: #3498db;
            border-left: 4px solid #2980b9;
        }

        .menu-item i {
            font-size: 1.2rem;
        }

        .sidebar-footer {
            padding: 15px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 10px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: background-color 0.3s;
        }

        .login-btn:hover {
            background-color: #c0392b;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            padding: 20px;
            margin-left: 250px;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .page-header h1 {
            color: #2c3e50;
            font-size: 1.8rem;
        }

        .khmer-title {
            font-family: 'Khmer OS', 'Moul', sans-serif;
            font-size: 2.2rem;
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background: linear-gradient(135deg, #3498db, #2c3e50);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .page {
            display: none;
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .page.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .page-content {
            line-height: 1.6;
            color: #555;
        }

        /* Iframe Styles */
        .page-content iframe {
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            min-height: 600px;
            border-radius: 8px;
            width: 100%;
        }

        /* Floating Toggle Button for Hidden Sidebar */
        .floating-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            opacity: 0;
            visibility: hidden;
        }

        .floating-toggle.visible {
            opacity: 1;
            visibility: visible;
        }

        /* Loading indicator */
        .iframe-loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .loading {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(52, 152, 219, 0.3);
            border-radius: 50%;
            border-top-color: #3498db;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 15px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 220px;
            }
            
            .main-content {
                margin-left: 220px;
                padding: 15px;
            }

            .floating-toggle {
                display: flex;
                opacity: 1;
                visibility: visible;
            }

            .khmer-title {
                font-size: 1.8rem;
            }

            .page {
                padding: 15px;
            }

            .page-content iframe {
                height: 600px !important;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>ការិយាល័យទី២</h2>
            <button class="toggle-btn" id="sidebarToggle">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="sidebar-menu">
            <div class="menu-item active" data-page="document">
                <i class="fas fa-file-alt"></i>
                <span>Document Page</span>
            </div>
            <div class="menu-item" data-page="factory">
                <i class="fas fa-industry"></i>
                <span>Factory Page</span>
            </div>
            <div class="menu-item" data-page="inspection">
                <i class="fas fa-search"></i>
                <span>Inspection Page</span>
            </div>
            <div class="menu-item" data-page="user">
                <i class="fas fa-users"></i>
                <span>User Management</span>
            </div>
        </div>
        <div class="sidebar-footer">
            <button class="login-btn" id="loginBtn">
                <i class="fas fa-sign-in-alt"></i>
                Login
            </button>
        </div>
    </div>

    <!-- Floating Toggle Button (shown when sidebar is hidden) -->
    <button class="floating-toggle" id="floatingToggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Document Page -->
        <div class="page active" id="document">
            <div class="page-content">
                <div class="iframe-loading" id="documentLoading">
                    <div class="loading"></div>
                    <p>កំពុងផ្ទុកទិន្នន័យ...</p>
                    <small style="color: #6c757d;" id="documentFileName">Checking file...</small>
                </div>
                <iframe src="" width="100%" height="100%" style="border: none; border-radius: 8px;" 
                        id="documentFrame"></iframe>
            </div>
        </div>

        <!-- Factory Page -->
        <div class="page" id="factory">
            <div class="page-content">
                <div class="iframe-loading" id="factoryLoading">
                    <div class="loading"></div>
                    <p>កំពុងផ្ទុកទិន្នន័យ...</p>
                    <small style="color: #6c757d;" id="factoryFileName">Checking file...</small>
                </div>
                <iframe src="" width="100%" height="100%" style="border: none; border-radius: 8px;" 
                        id="factoryFrame"></iframe>
            </div>
        </div>

        <!-- Inspection Page -->
        <div class="page" id="inspection">
            <div class="page-content">
                <div class="iframe-loading" id="inspectionLoading">
                    <div class="loading"></div>
                    <p>កំពុងផ្ទុកទិន្នន័យ...</p>
                    <small style="color: #6c757d;" id="inspectionFileName">Checking file...</small>
                </div>
                <iframe src="" width="100%" height="100%" style="border: none; border-radius: 8px;" 
                        id="inspectionFrame"></iframe>
            </div>
        </div>

        <!-- User Management Page -->
        <div class="page" id="user">
            <div class="page-content">
                <div class="iframe-loading" id="userLoading">
                    <div class="loading"></div>
                    <p>កំពុងផ្ទុកទិន្នន័យ...</p>
                    <small style="color: #6c757d;" id="userFileName">Checking file...</small>
                </div>
                <iframe src="" width="100%" height="100%" style="border: none; border-radius: 8px;" 
                        id="userFrame"></iframe>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const sidebar = document.querySelector('.sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const floatingToggle = document.getElementById('floatingToggle');
        const mainContent = document.getElementById('mainContent');
        const menuItems = document.querySelectorAll('.menu-item');
        const pages = document.querySelectorAll('.page');
        const loginBtn = document.getElementById('loginBtn');

        // Iframe references
        const iframes = {
            document: document.getElementById('documentFrame'),
            factory: document.getElementById('factoryFrame'),
            inspection: document.getElementById('inspectionFrame'),
            user: document.getElementById('userFrame')
        };

        // File name configurations - CORRECTED WITH YOUR FILES
        const fileConfigs = [
            {
                document: 'documents-section.html',
                factory: 'factories-section.html',
                inspection: 'inspection-section.html',
                user: 'users-section.html'
            }
        ];

        let currentConfigIndex = 0;
        let currentFiles = fileConfigs[currentConfigIndex];

        // Debug function
        function debug(message) {
            console.log(`[Sidebar Debug] ${message}`);
        }

        // Update floating toggle button visibility
        function updateFloatingToggle() {
            if (sidebar.classList.contains('hidden')) {
                floatingToggle.classList.add('visible');
            } else {
                floatingToggle.classList.remove('visible');
            }
        }

        // Check if file exists
        async function checkFileExists(filename) {
            try {
                const response = await fetch(filename, { method: 'HEAD' });
                return response.ok;
            } catch (error) {
                return false;
            }
        }

        // Auto-detect correct file names
        async function autoDetectFiles() {
            debug('Auto-detecting file names...');
            
            for (let config of fileConfigs) {
                debug(`Trying configuration: ${JSON.stringify(config)}`);
                
                const checks = await Promise.all([
                    checkFileExists(config.document),
                    checkFileExists(config.factory),
                    checkFileExists(config.inspection),
                    checkFileExists(config.user)
                ]);
                
                if (checks.every(exists => exists)) {
                    debug(`Found working configuration: ${JSON.stringify(config)}`);
                    currentFiles = config;
                    updateFileDisplays();
                    loadInitialPage();
                    return;
                }
            }
            
            // If no configuration works, show error
            debug('No working file configuration found');
            showConfigurationError();
        }

        function updateFileDisplays() {
            document.getElementById('documentFileName').textContent = currentFiles.document;
            document.getElementById('factoryFileName').textContent = currentFiles.factory;
            document.getElementById('inspectionFileName').textContent = currentFiles.inspection;
            document.getElementById('userFileName').textContent = currentFiles.user;
        }

        function showConfigurationError() {
            const errorHTML = `
                <div style="color: #dc3545; text-align: center;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 15px;"></i>
                    <h4>មិនអាចរកឃើញឯកសារ</h4>
                    <p>សូមពិនិត្យថាឯកសារទាំងនេះមាននៅក្នុងថតដូចគ្នា:</p>
                    <div style="text-align: left; background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 15px 0;">
                        <code>
                        - components/documents-section.html<br>
                        - components/factories-section.html<br>
                        - components/inspection-section.html<br>
                        - components/users-section.html
                        </code>
                    </div>
                    <button class="btn btn-primary" onclick="autoDetectFiles()" style="margin-top: 15px;">
                        <i class="fas fa-search"></i> ស្វែងរកម្តងទៀត
                    </button>
                </div>
            `;
            
            ['documentLoading', 'factoryLoading', 'inspectionLoading', 'userLoading'].forEach(id => {
                const element = document.getElementById(id);
                if (element) element.innerHTML = errorHTML;
            });
        }

        function loadInitialPage() {
            // Load the document page by default
            iframes.document.src = currentFiles.document;
            iframes.document.onload = () => hideLoading('document');
            iframes.document.onerror = () => showLoadError('document', `Cannot load ${currentFiles.document}`);
        }

        // Toggle Sidebar
        function toggleSidebar() {
            sidebar.classList.toggle('hidden');
            mainContent.classList.toggle('expanded');
            
            const icon = sidebarToggle.querySelector('i');
            if (sidebar.classList.contains('hidden')) {
                icon.className = 'fas fa-bars';
                floatingToggle.innerHTML = '<i class="fas fa-bars"></i>';
            } else {
                icon.className = 'fas fa-times';
                floatingToggle.innerHTML = '<i class="fas fa-bars"></i>';
            }
            
            updateFloatingToggle();
        }

        // Switch Pages
        function switchPage(pageId) {
            debug(`Switching to page: ${pageId}`);
            
            // Update active menu item
            menuItems.forEach(item => {
                if (item.getAttribute('data-page') === pageId) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // Show selected page
            pages.forEach(page => {
                if (page.id === pageId) {
                    page.classList.add('active');
                } else {
                    page.classList.remove('active');
                }
            });
            
            // Load the iframe content
            loadIframeContent(pageId);
        }

        function loadIframeContent(pageId) {
            showLoading(pageId);
            
            const iframe = iframes[pageId];
            const fileName = currentFiles[pageId];
            
            debug(`Loading ${fileName} for ${pageId}`);
            
            iframe.src = fileName;
            iframe.onload = () => {
                hideLoading(pageId);
                adjustIframeHeight(pageId);
                debug(`Successfully loaded ${fileName}`);
            };
            iframe.onerror = () => {
                showLoadError(pageId, `Cannot load ${fileName}`);
                debug(`Failed to load ${fileName}`);
            };
        }

        // Adjust iframe height based on content
        function adjustIframeHeight(pageId) {
            const iframe = iframes[pageId];
            if (iframe && iframe.contentWindow) {
                try {
                    const height = iframe.contentWindow.document.body.scrollHeight;
                    iframe.style.height = Math.max(height, 800) + 'px';
                    debug(`Adjusted iframe height for ${pageId}: ${height}px`);
                } catch (e) {
                    iframe.style.height = '100%';
                    debug(`Using default height for ${pageId}`);
                }
            }
        }

        function showLoadError(pageId, message) {
            const loadingElement = document.getElementById(pageId + 'Loading');
            loadingElement.innerHTML = `
                <div style="color: #dc3545; text-align: center;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 15px;"></i>
                    <h4>មិនអាចផ្ទុកទំព័រ</h4>
                    <p>${message}</p>
                    <p style="font-size: 0.9rem; color: #6c757d; margin-top: 10px;">
                        Trying to load: ${currentFiles[pageId]}
                    </p>
                    <button class="btn btn-primary" onclick="loadIframeContent('${pageId}')" style="margin-top: 15px;">
                        <i class="fas fa-redo"></i> ព្យាយាមម្តងទៀត
                    </button>
                    <br>
                    <button class="btn btn-outline-secondary" onclick="autoDetectFiles()" style="margin-top: 10px;">
                        <i class="fas fa-search"></i> Auto-detect Files
                    </button>
                </div>
            `;
        }

        // Hide loading indicator when iframe loads
        function hideLoading(pageId) {
            const loadingElement = document.getElementById(pageId + 'Loading');
            if (loadingElement) {
                loadingElement.style.display = 'none';
            }
        }

        // Show loading indicator
        function showLoading(pageId) {
            const loadingElement = document.getElementById(pageId + 'Loading');
            if (loadingElement) {
                loadingElement.style.display = 'block';
                loadingElement.innerHTML = `
                    <div class="loading"></div>
                    <p>កំពុងផ្ទុកទិន្នន័យ...</p>
                    <small style="color: #6c757d;">${currentFiles[pageId]}</small>
                `;
            }
        }

        // Redirect to login page
        function redirectToLogin() {
            window.location.href = 'login.html';
        }

        // Event Listeners
        sidebarToggle.addEventListener('click', toggleSidebar);
        floatingToggle.addEventListener('click', toggleSidebar);
        loginBtn.addEventListener('click', redirectToLogin);

        menuItems.forEach(item => {
            item.addEventListener('click', function() {
                const pageId = this.getAttribute('data-page');
                switchPage(pageId);
                
                if (window.innerWidth <= 768) {
                    toggleSidebar();
                }
            });
        });

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !sidebar.contains(event.target) && 
                !floatingToggle.contains(event.target) && 
                !sidebar.classList.contains('hidden')) {
                toggleSidebar();
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            debug('DOM Content Loaded');
            updateFloatingToggle(); // Set initial state
            autoDetectFiles();
        });

        // Make functions globally available for buttons
        window.handleIframeLoad = (pageId) => hideLoading(pageId);
        window.handleIframeError = (pageId) => showLoadError(pageId, 'Load error');
        window.retryLoad = (pageId) => loadIframeContent(pageId);
        window.autoDetectFiles = autoDetectFiles;
        window.toggleSidebar = toggleSidebar;
    </script>
</body>
</html>