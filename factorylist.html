<!DOCTYPE html>
<html lang="km">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>បញ្ជីរោងចក្រ | Office 2</title>
  <link rel="stylesheet" href="factorylist.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.19.3/xlsx.full.min.js"></script>

</head>
<body>
    <div id="navbar"></div>
    
  <!-- Factory List Section -->
  <section class="factory-section">
    <h2>បញ្ជីរោងចក្រ / Factory List</h2>
      <div class="search-bar">
        <button class="map-btn">Add Factory</button>
        <input type="text" id="searchInput" placeholder="ស្វែងរកឈ្មោះសហគ្រាស..." />
        <button id="exportExcel" class="map-btn">Download Excel</button>
      </div>
    <table id="factoryTable">
      <thead>
        <tr>
          <th>ល.រ</th>
          <th>នាមករណ៍សហគ្រាស (ខ្មែរ)</th>
          <th>នាមករណ៍សហគ្រាស (អង់គ្លេស)</th>
          <th>វិស័យ</th>
          <th>ភូមិ</th>
          <th>ឃុំ/សង្កាត់</th>
          <th>ស្រុក/ក្រុង/ខណ្ឌ</th>
          <th>រាជធានី/ខេត្ត</th>
          <th>កម្មករសរុប</th>
          <th>(ស្រី)</th>
          <th>ឈ្មោះរដ្ឋបាល</th>
          <th>លេខរដ្ឋបាល</th>

          <th>ACTION</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td>សហគ្រាស វីសិន</td>
          <td>Vision Factory</td>
          <td>កាត់ដេរ</td>
          <td>ភូមិទួលសង្កែ</td>
          <td>សង្កាត់ទួលសង្កែ</td>
          <td>ខណ្ឌរលាប្អៀរ</td>
          <td>ភ្នំពេញ</td>
          <td>250</td>
          <td>160</td>
          <td>សុខ ចាន់នី</td>
          <td>012345678</td>
          <td>
              <div>
                <button class="view-btn">View</button>
                <a href="editpage.html" id="services-link" class="btn-link" target="_blank">Editing Link</a>
              </div>
          </td>
        </tr>
          <tr>
            <td>2</td>
            <td>ឡូស៊ីដា</td>
            <td>Lucida</td>
            <td>កាត់ដេរ</td>
            <td>ភូមិទួលសង្កែ</td>
            <td>សង្កាត់ទួលសង្កែ</td>
            <td>ខណ្ឌរលាប្អៀរ</td>
            <td>ភ្នំពេញ</td>
            <td>250</td>
            <td>160</td>
            <td>សុខ ចាន់នី</td>
            <td>012345678</td>
            <td>
                <div>
                  <button class="view-btn">View</button>
                  <a href="editpage.html" id="services-link" class="btn-link" target="_blank">Editing Link</a>
                </div>
            </td>
        </tr>
      </tbody>
    </table>
  </section>

<!-- Factory Detail Modal -->
<div id="factoryModal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h3>ព័ត៌មានរោងចក្រ / Factory Details</h3>
    <div id="factoryDetail"></div>
  </div>
</div>


  <script src="factory-list.js" ></script>
</body>
<script>
     fetch('navbar.html')
    .then(response => response.text())
    .then(data => {
      document.getElementById('navbar').innerHTML = data;

      // Highlight current page
      const currentPage = window.location.pathname.split("/").pop();
      const links = document.querySelectorAll(".navbar a");

      links.forEach(link => {
        if (link.getAttribute("href") === currentPage) {
          link.classList.add("active");
        }
      });
    });

/// View button functionality
document.addEventListener("click", function(e) {
  if (e.target.classList.contains("view-btn")) {
    const row = e.target.closest("tr");
    const cells = row.querySelectorAll("td");

    const factoryInfo = `
      <p><strong>ឈ្មោះសហគ្រាស (ខ្មែរ):</strong> ${cells[1].textContent}</p>
      <p><strong>ឈ្មោះសហគ្រាស (អង់គ្លេស):</strong> ${cells[2].textContent}</p>
      <p><strong>វិស័យ:</strong> ${cells[3].textContent}</p>
      <p><strong>ទីតាំង:</strong> ${cells[4].textContent}, ${cells[5].textContent}, ${cells[6].textContent}, ${cells[7].textContent}</p>
      <p><strong>កម្មករសរុប:</strong> ${cells[8].textContent} (ស្រី: ${cells[9].textContent})</p>
      <p><strong>អ្នកទំនាក់ទំនង:</strong> ${cells[10].textContent} (${cells[11].textContent})</p>
    `;

    document.getElementById("factoryDetail").innerHTML = factoryInfo;
    document.getElementById("factoryModal").style.display = "block";
  }
});

// Close modal
document.addEventListener("click", function(e) {
  if (e.target.classList.contains("close-btn") || e.target.id === "factoryModal") {
    document.getElementById("factoryModal").style.display = "none";
  }
});

// Export table to Excel
document.getElementById("exportExcel").addEventListener("click", function () {
  // Get the table
  var table = document.getElementById("factoryTable");

  // Convert table to workbook
  var wb = XLSX.utils.table_to_book(table, { sheet: "Factory List" });

  // Export to Excel file
  XLSX.writeFile(wb, "Factory_List.xlsx");
});


</script>
</html>